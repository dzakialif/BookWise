<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- box icons -->
        <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
            rel="stylesheet" />
        <!-- bootstrap -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous" />
        <!-- css -->
        <link rel="stylesheet" href="style.css">
        <title>Dashboard Admin</title>
    </head>
    <body>
        <!-- sidebar -->
        <!-- sidebar -->
        <div class="sidebar" id="sidebar">
            <a href="#" class="logo">
                <i class="bx bxs-book"></i>
                <div class="logo-name"><span>Book</span>Wise</div>
            </a>
        </div>
        <!-- sidebar -->
        <!-- content -->
        <div class="content">
            <!-- navbar -->
            <nav>
                <a href="#" class="logo">
                    <i class="bx bxs-book"></i>
                    <div class="logo-name"><span>Book</span>Wise</div>
                </a>
                <i class='bx bx-menu'></i>
                <form action="#">
                    <div class="form-input">
                        <input type="search" name id placeholder="Search...">
                        <button class="search-btn" type="submit"><i
                                class='bx bx-search'></i></button>
                    </div>
                </form>
                <input type="checkbox" name id="theme-toggle" hidden>
                <label for="theme-toggle" class="theme-toggle"></label>
                <a href="#" class="notif">
                    <i class='bx bx-bell'></i>
                    <span class="count">12</span>
                </a>
                <a href="#" class="profile">
                    <img src="img/profile.jpg" alt>
                </a>
            </nav>
            <!-- navbar -->
            <!-- main -->
            <main>
                <div class="header">
                    <div class="left">
                        <h1>Category</h1>
                        <ul class="breadcrumb">
                            <li><a href="#">
                                    BookWise
                                </a></li>
                            /
                            <li><a href="#" class="active">Category</a></li>
                        </ul>
                    </div>
                    <a href="addcategory.html" class="report">
                        <i class="bx bx-add-to-queue"></i>
                        <span>Add Category</span>
                    </a>
                </div>
                <!-- table data -->
                <div class="bottom-data">
                    <div class="orders">
                        <!-- <div class="header">
              <i class='bx bx-receipt'></i>
              <h3>Data Login Admin</h3>
              <i class='bx bx-filter'></i>
              <i class='bx bx-search'></i>
            </div> -->
                        <table class>
                            <thead>
                                <tr>
                                    <th scope="col">No</th>
                                    <th scope="col">Nama</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="dataCategory"></tbody>
                        </table>
                    </div>
                </div>
                <!-- table data -->
            </main>

            <!-- main -->
        </div>
        <!-- content -->

        <!-- modal -->
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1"
            aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Edit
                            Category</h1>
                        <button type="button" class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="editModal">
                            <div class="mb-3">
                                <label for="categoryModal"
                                    class="form-label">Category</label>
                                <input type="text" class="form-control"
                                    id="categoryModal" />
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary"
                            id="saveChanges">Save
                            changes</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- modal -->

        <!-- script -->
        <!-- Bootstrap CSS -->
        <!-- <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet" /> -->
        <!-- Bootstrap JavaScript -->
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script>
      let userCreds = JSON.parse(sessionStorage.getItem('user-credentials'));
      let userInfo = JSON.parse(sessionStorage.getItem('user-info'));

      let signOut = () => {
        sessionStorage.removeItem('user-credentials');
        sessionStorage.removeItem('user-info');
        window.location.href = 'index.html';
      };

      let checkCreds = () => {
        if (!sessionStorage.getItem('user-credentials')) window.location.href = 'index.html';
      };

      window.addEventListener('load', () => {
        checkCreds();

        // Tambahkan event listener pada elemen logout setelah halaman selesai dimuat
        const signOutElement = document.getElementById('signOut');
        if (signOutElement) {
          signOutElement.addEventListener('click', (event) => {
            event.preventDefault(); // Mencegah tindakan default dari elemen <a>
            signOut();
            window.location.href = 'index.html';
            sessionStorage.removeItem('user-credentials');
            sessionStorage.removeItem('user-info');
          });
        }
      });
    </script>
        <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
      import { getDatabase, set, ref, update, push, remove, onValue } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: 'AIzaSyDfQFDdp63MMbrV4txPeACunFsAulv5K38',
        authDomain: 'bookwise-fca71.firebaseapp.com',
        projectId: 'bookwise-fca71',
        storageBucket: 'bookwise-fca71.appspot.com',
        messagingSenderId: '77745378217',
        appId: '1:77745378217:web:1cbca8213e84bdc80f6ab8',
        measurementId: 'G-MTQNNS7YW8',
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      // Function to fetch and display categories
      function dataCategory() {
        const dbRef = ref(database, 'category/');
        onValue(dbRef, (snapshot) => {
          const data = snapshot.val();
          const dataCategory = document.getElementById('dataCategory');
          dataCategory.innerHTML = '';
          let count = 1;
          for (let id in data) {
            const row = `<tr>
                    <th scope="row">${count++}</th>
                    <td>${data[id].category}</td>
                    <td>
                    <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="editData('${id}', '${data[id].category}')">Edit
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deleteData('${id}')">Delete</button>
                    </td>
                </tr>`;
            dataCategory.innerHTML += row;
          }
        });
      }

      // Menampilkan data di modal untuk diedit
      window.editData = function (id, category) {
        document.getElementById('categoryModal').value = category;

        const saveChangesButton = document.getElementById('saveChanges');
        saveChangesButton.onclick = function () {
          const categoryUpdate = document.getElementById('categoryModal').value;

          const dbRef = ref(database, `category/${id}`);
          update(dbRef, {
            category: categoryUpdate,
          })
            .then(() => {
              alert('Data berhasil diperbarui!');
              dataCategory();

              // Close modal after changes are saved
              const modalElement = document.getElementById('exampleModal');
              const modal = bootstrap.Modal.getInstance(modalElement);
              modal.hide();
            })
            .catch((error) => {
              console.error('Gagal memperbarui data: ', error);
            });
        };
      };

      // Fungsi untuk menghapus data dari Firebase
      window.deleteData = function (id) {
        const dbRef = ref(database, `category/${id}`);
        remove(dbRef)
          .then(() => {
            alert('Kontak berhasil dihapus!');
            dataCategory(); // Memperbarui tabel dengan data terbaru
          })
          .catch((error) => {
            console.error('Gagal menghapus kontak: ', error);
          });
      };

      // Display categories when page loads
      window.onload = function () {
        dataCategory();
      };
    </script>

        <!-- <script type="module" src="script.js"></script> -->
        <script type="module" src="scriptbar.js"></script>
    </body>
</html>
